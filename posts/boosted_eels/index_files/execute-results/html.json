{
  "hash": "e5bf20b6e2b2a703b665f9f5b590df0c",
  "result": {
    "markdown": "---\ntitle: \"Eel Species Distribution Modeling Using Boosted Trees\"\ndescription: \"A case study of species distribution modeling, following a modeling project described by Edith et al. 2008.\"\nauthor:\n  - name: Gabrielle Smith\n    url: https://gabriellensmith.github.io\n    affiliation: MEDS\n    affiliation-url: https://ucsb-meds.github.io/\ndate: 2023-06-20\ncatergories: [MEDS, Machine Learning, R]\nimage: eel.jpeg\neditor: visual\ntoc: true\ndraft: false\nformat: \n  html:\n    code-fold: true\n    code-tools: true\n    code-summary: 'code'\n---\n\n\n## Description: \n\nIn this post, I perform a case study example of species distribution modeling in a reproduction of the work done by [Edith et al. 2008](https://besjournals.onlinelibrary.wiley.com/doi/10.1111/j.1365-2656.2008.01390.x) \\[1\\]. For this case study, we model the short-finned eel (*Anguilla australis*) species using Boosted Regression Trees. This analysis is derived from an assignment for EDS232: Machine Learning in Environmental Science, as part of the curriculum for UCSB's Master's of Environmental Data Science program.\n\nBoosted regression trees, also known as gradient boosting machines, are machine learning techniques that combine concepts of regression trees (relating responses to predictors using recursive binary splits) and iterative boosting (an adaptive method for combining simple models to improve predictive performance). In this case study, decision trees are built sequentially using extreme gradient boosting to classify the presence or absence of short-finned eel in a given location with covariates including temperature, slope, rainy days, etc. The work provided by Edith et al. utilizes the {gbm} package in R, while this analysis follows a {tidymodels} approach in R. \n\n## Data \n\nOur data for this analysis, \"eel.model.data.csv\" were retrived from the supplemental information of Edith et al. 2008. These data include the following variables:\n\n![Figure 1: Table 1. from Elith et al. 2008 displaying the variables included in the analysis.](variables.png)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load required libraries\nlibrary(tidyverse)\nlibrary(rsample)\nlibrary(glmnet)\nlibrary(tidymodels)\nlibrary(ggplot2)\nlibrary(sjPlot)\nlibrary(pROC)\nlibrary(RColorBrewer)\n\n\neel_data <- eel_data_raw |> \n  janitor::clean_names() \n\n# remove site number from modeling data\neel_model <- eel_data[,-1]\n\n# convert presence of angaus, downstream obstructions, and fishing methods to factors\neel_model$angaus <- as.factor(eel_model$angaus)\neel_model$ds_dam <- as.factor(eel_model$ds_dam)\neel_model$method <- as.factor(eel_model$method)\n\ntab_df(eel_data[1:5,],\n       title = \"Table. 1\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table. 1</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">site</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">angaus</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">seg_sum_t</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">seg_t_seas</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">seg_low_flow</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">ds_dist</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col7\">ds_max_slope</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col8\">us_avg_t</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col9\">us_rain_days</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 0\">us_slope</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 1\">us_native</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 2\">ds_dam</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 3\">method</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; 4\">loc_sed</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">16.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">-0.10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.04</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">50.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.57</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.09</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">2.47</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 0\">9.80</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 1\">0.81</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 2\">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 3\">electric</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 4\">4.80</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">18.70</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.51</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">132.53</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">1.15</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">1.15</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 0\">8.30</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 1\">0.34</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 2\">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 3\">electric</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 4\">2.00</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">18.30</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.37</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">107.44</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.57</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.49</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">0.85</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 0\">0.40</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 1\">0.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 2\">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 3\">spo</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 4\">1.00</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">16.70</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">-3.80</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">166.82</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">1.72</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.90</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">0.21</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 0\">0.40</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 1\">0.22</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 2\">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 3\">electric</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; 4\">4.00</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">5</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">17.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.33</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">1.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">3.95</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col7\">1.15</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col8\">-1.20</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col9\">1.98</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 0\">21.90</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 1\">0.96</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 2\">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 3\">electric</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; 4\">4.70</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n\n## Split and Resample\n\nWe split the above data into a training and test set, stratifying by the outcome score (angaus) to maintain class balance, improve generalization, and ensure the reliability of evaluation in modeling performances. We then use a 10-fold cross validation to resample the training set, also stratified by outcome score. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set a seed for reproducibility\nset.seed(123)\n\n#stratified sampling with the {rsample} package\neel_split <- initial_split(data = eel_model, prop = 0.7, strata = angaus)\n\neel_train <- training(eel_split)\neel_test <- testing(eel_split)\n\n# 10-fold cross validation, stratified by our outcome variable, angaus \ncv_folds <- eel_train |> \n  vfold_cv(v=10, strata = angaus)\n```\n:::\n\n\n## Preprocess\n\nNext, we create a recipe to prepape the data for the XGBoost model. For this analysis, we are interested in predicting the binary outcome variable angaus, which indicates presence or absence of the eel species Anguilla australis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create a recipe \nboost_rec <- recipe(angaus ~., data = eel_train) |> \n  step_normalize(all_numeric()) |> \n  step_dummy(all_nominal(), -all_outcomes(), one_hot = TRUE) |> \n  prep()\n\n# bake to check recipe\nbaked_train <- bake(boost_rec, eel_train) \nbaked_test <- bake(boost_rec, eel_test) \n```\n:::\n\n\n## Tuning XGBoost\n\n### Tune Learning Rate \n\nTo begin, we perform tuning on just the *learn_rate* parameter.\n\nWe create a model specification using {xbgoost} for the estimation, specifying only the learn_rate parameter for tuning.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create a model for specification\nlearn_spec <- boost_tree(learn_rate = tune()) |> \n  set_engine('xgboost') |> \n  set_mode('classification') \n```\n:::\n\n\nNext, we build a grid to tune our model by using a range of learning rate parameter values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#set a grid to tune hyperparameter values\nlearn_grid <- expand.grid(learn_rate = seq(0.0001, 0.3, length.out = 30))\n```\n:::\n\n\nThen, we define a new workflow and tune the model using the learning rate grid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#define a new workflow \nlearn_wf <- workflow() |> \n  add_model(learn_spec) |> \n  add_recipe(boost_rec)\n\ndoParallel::registerDoParallel()\nset.seed(123)\n\n#tune the model\nlearn_tune <- learn_wf |> \n  tune_grid(cv_folds, grid=learn_grid) \n\n#show the performance of the best models \nshow_best(learn_tune, metric = 'roc_auc') |> \n  tab_df(title = 'Table 2',\n         digits = 4,\n         footnote = 'Top performing models and their associated estimates for various learning rate parameter values.',\n         show.footnote=TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 2</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">learn_rate</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">mean</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">n</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">std_err</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col7\">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0.2690</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8524</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0143</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">Preprocessor1_Model27</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0.1862</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8451</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0086</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">Preprocessor1_Model19</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0.2586</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8444</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0120</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">Preprocessor1_Model26</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">0.2380</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8442</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0128</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">Preprocessor1_Model24</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">0.1759</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8434</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.0129</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col7\">Preprocessor1_Model18</td>\n</tr>\n<tr>\n<td colspan=\"8\" style=\"font-style:italic; border-top:double black; text-align:right;\">Top performing models and their associated estimates for various learning rate parameter values.</td>\n</tr>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n#save the best model parameters to be used in future tuning\nbest_learnrate <- as.numeric(show_best(learn_tune, metric = 'roc_auc')[1,1])\n```\n:::\n\n\n## Tune Tree Parameters\n\nFollowing the tuning of the learning rate parameter, we create a new specification with a set optimized learning rate from our previous optimization. Now, we shift our focus on tuning the tree parameters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create a new specificatin with set learning rate \ntree_spec <- boost_tree(learn_rate = best_learnrate,\n                         min_n = tune(),\n                         tree_depth = tune(),\n                         loss_reduction = tune(),\n                         trees = 3000) |> \n  set_mode('classification') |> \n  set_engine('xgboost')\n```\n:::\n\n\nAgain, we create a tuning grid, this time utilizing grid_max_entropy() to get a representative sampling of the parameter space. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#specify parameters for the tuning grid \ntree_params <- dials::parameters(min_n(),\n                           tree_depth(),\n                           loss_reduction())\n\n#set the tuning grid \ntree_grid <- grid_max_entropy(tree_params, size = 20)\n\n#define a new workflow \ntree_wf <- workflow() |> \n  add_model(tree_spec) |> \n  add_recipe(boost_rec)\n\nset.seed(123)\ndoParallel::registerDoParallel()\n\n#tune the model\ntree_tuned <- tree_wf |> \n  tune_grid(cv_folds, grid = tree_grid)\n\n#show the performance of the best models \nshow_best(tree_tuned, metric = 'roc_auc') |> \n  tab_df(title = 'Table 3',\n         digits = 4,\n         footnote = 'Top performing models and their associated estimates for various tree parameter values.',\n         show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 3</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">min_n</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">tree_depth</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">loss_reduction</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">mean</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col7\">n</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col8\">std_err</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col9\">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0010</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8572</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0154</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model12</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">6</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">11</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0000</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8544</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0150</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model10</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.0000</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8528</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0143</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model14</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">7</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">9</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">4.9468</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8492</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">0.0130</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col9\">Preprocessor1_Model04</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">15</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.0000</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8472</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col7\">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col8\">0.0141</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col9\">Preprocessor1_Model11</td>\n</tr>\n<tr>\n<td colspan=\"10\" style=\"font-style:italic; border-top:double black; text-align:right;\">Top performing models and their associated estimates for various tree parameter values.</td>\n</tr>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n#save the best model parameters to be used for future tuning\nbest_minn <- as.numeric(show_best(tree_tuned, metric = 'roc_auc')[1,1])\n\nbest_treedepth <- as.numeric(show_best(tree_tuned, metric = 'roc_auc')[1,2])\n\nbest_lossreduction <- as.numeric(show_best(tree_tuned, metric = 'roc_auc')[1,3])\n```\n:::\n\n\n## Tune Stochastic Parameters\n\nWe create one final specification, setting the learn rate and tree parameters to their optimal values defined in previous tuning iterations. Our final tuning is of the stochastic parameters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create a new specificatin with set learning rate and tree parameters\nstoch_tune <- boost_tree(learn_rate = best_learnrate,\n                         min_n = best_minn,\n                         tree_depth = best_treedepth,\n                         loss_reduction = best_lossreduction,\n                         trees = 3000,\n                         mtry = tune(), \n                         sample_size = tune()) |> \n  set_mode('classification') |> \n  set_engine('xgboost')\n```\n:::\n\n\nWe set up a tuning grid, again utilizing grid_max_entropy().\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#set parameters for the tuning grid \nstoch_params <- parameters(finalize(mtry(), eel_train),\n                          sample_size = sample_prop())\n\n#set the tuning grid \nstoch_grid <- grid_max_entropy(stoch_params, size = 20)\n\n#define a new workflow \nstoch_wf <- workflow() |> \n  add_model(stoch_tune) |> \n  add_recipe(boost_rec) \n\nset.seed(123)\ndoParallel::registerDoParallel()\n\n#tune the model \nstoch_tuned <- stoch_wf |> \n  tune_grid(cv_folds, grid = stoch_grid)\n\n#show the performance of the best models \nshow_best(stoch_tuned, metric = 'roc_auc') |> \n  tab_df(title = 'Table 4',\n         digits = 4,\n         footnote = 'Top performing models and their associated estimates for various stochiastic parameter values.',\n         show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 4</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">mtry</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">sample_size</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">mean</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">n</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col7\">std_err</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; col8\">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.9907</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8618</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.0136</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">Preprocessor1_Model04</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">8</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.9930</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8586</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.0129</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">Preprocessor1_Model19</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">8</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.7407</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8574</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.0151</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">Preprocessor1_Model18</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8529</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8559</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col7\">0.0128</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; col8\">Preprocessor1_Model10</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8646</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8545</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col7\">0.0137</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; col8\">Preprocessor1_Model06</td>\n</tr>\n<tr>\n<td colspan=\"9\" style=\"font-style:italic; border-top:double black; text-align:right;\">Top performing models and their associated estimates for various stochiastic parameter values.</td>\n</tr>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n#save the best model parameters to be used for model finalization\nbest_mtry <- as.numeric(show_best(stoch_tuned, metric = 'roc_auc')[1,1])\nbest_samplesize <- as.numeric(show_best(stoch_tuned, metric = 'roc_auc')[1,2])\n```\n:::\n\n\nNow that we have tuned all of our relevant hyperparameters, we assemble a final workflow and do a final fit. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create a final specification with all set optimized parameters \nfinal_model <-  boost_tree(learn_rate = best_learnrate,\n                         min_n = best_minn,\n                         tree_depth = best_treedepth,\n                         loss_reduction = best_lossreduction,\n                         trees = 3000,\n                         mtry = best_mtry, \n                         sample_size = best_samplesize) |> \n  set_mode('classification') |> \n  set_engine('xgboost') \n\n#define a final workflow \nfinal_wf <- workflow() |> \n  add_model(final_model) |> \n  add_recipe(boost_rec) \n\n#fit training data on final wf\nfinal_fit <- final_wf |> \n  fit(eel_train)\n\nfinal_eel_fit <- last_fit(final_model, angaus~., eel_split)\n\nfinal_pred <- as.data.frame(final_eel_fit$.predictions)\n\ntab_df(head(final_pred),\n       title = 'Table 5',\n       digits = 4,\n       footnote = 'Predictions of Angaus presence on test data.',\n       show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 5</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">.pred_0</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.pred_1</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.row</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.pred_class</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">angaus</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.9999</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0001</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.0085</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.9915</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.9810</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0190</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">3</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.9468</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0532</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">4</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; modelcolumn0 \">0.9995</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.0005</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">9</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; modelcolumn0 \">0.2945</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double;  \">0.7055</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">10</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">1</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td colspan=\"7\" style=\"font-style:italic; border-top:double black; text-align:right;\">Predictions of Angaus presence on test data.</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#bind predictions and original data \neel_test_bind <- cbind(eel_test, final_eel_fit$.predictions)\n\n#remove duplicate column\neel_test_bind <- eel_test_bind[,-1]\n\n#compute a confusion matrix\nconfusion_matrix <- eel_test_bind |> \n  yardstick::conf_mat(truth = angaus, estimate = .pred_class)\n\nautoplot(confusion_matrix, type = \"heatmap\") +\n  scale_fill_gradient(low = \"#C7E9FB\", high = \"#084594\") +\n  theme(axis.text.x = element_text(size = 12),\n        axis.text.y = element_text(size = 12),\n        axis.title = element_text(size = 14),\n        panel.background = element_rect(fill = \"#F8F8F8\"),\n        plot.background = element_rect(fill = \"#F8F8F8\")) +\n  labs(title = \"Figure 2: Confusion matrix of predictions on test data.\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for fill is already present.\nAdding another scale for fill, which will replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# store accuracy metrics \nfinal_metrics <- final_eel_fit$.metrics\n\ntab_df(final_metrics,\n       title = 'Table 6',\n       digits = 4,\n       footnote = 'Accuracy and Area Under the Receiver Operator Curve (ROC) of the final fit.',\n       show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 6</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimate</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.config</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.81063122923588</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.819193989071038</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">Preprocessor1_Model1</td>\n</tr>\n<tr>\n<td colspan=\"5\" style=\"font-style:italic; border-top:double black; text-align:right;\">Accuracy and Area Under the Receiver Operator Curve (ROC) of the final fit.</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n\nThe final model has an accuracy of 0.80. The ROC area under the curve is 0.82.\n\n## Fit model evaluation data and compare performance \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read in evaluation data \neval_data <- read_csv('eel.eval.data.csv', show_col_types = FALSE) |> \n  janitor::clean_names() |> \n  rename(angaus = angaus_obs)\n\n# convert presence of angaus, downstream obstructions, and fishing methods to factors\neval_data$angaus <- as.factor(eval_data$angaus)\neval_data$ds_dam <- as.factor(eval_data$ds_dam)\neval_data$method <- as.factor(eval_data$method)\n\n#fit final model to big dataset\n#class predictions\neval_classpred <- final_fit |> \n  predict(eval_data)\n\n#probability predictions\neval_probpred <- final_fit |> \n  predict(eval_data, type = 'prob')\n\neval_df <- cbind(eval_classpred, eval_probpred, eval_data)\n\n#accuracy measure\naccuracy <- accuracy(eval_df, truth = angaus, estimate = .pred_class)\n#roc_auc measure \nroc <- roc_auc(eval_df, truth = angaus, estimate = .pred_0)\n\nmetrics <- rbind(accuracy, roc)\ntab_df(metrics, \n       title = 'Table 7',\n       digits = 4,\n       footnote = 'Accuracy and Area Under the Receiver Operator Curve (ROC) of the model fit to evaluation data.',\n       show.footnote = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 7</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; text-align:left; \">.metric</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimator</th>\n<th style=\"border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; \">.estimate</th>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">accuracy</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; \">0.8200</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; border-bottom: double; \">roc_auc</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">binary</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center; border-bottom: double; \">0.8476</td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"font-style:italic; border-top:double black; text-align:right;\">Accuracy and Area Under the Receiver Operator Curve (ROC) of the model fit to evaluation data.</td>\n</tr>\n</table>\n\n`````\n:::\n:::\n\n\n#### How does this model perform on the evaluation data?\n\nThe final model, fit to the evaluation data, has an accuracy of 0.82, and the ROC area under the curve is 0.85. For comparison, the model produced by Edith et al. had a ROC area under the curve of 0.858. \n\n## References \n\n\\[1\\] Elith, J., Leathwick, J.R. and Hastie, T. (2008), A working guide to boosted regression trees. Journal of Animal Ecology, 77: 802-813. https://doi.org/10.1111/j.1365-2656.2008.01390.x\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}